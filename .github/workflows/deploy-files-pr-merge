name: Deploy Files on PR Merge

on:
  pull_request:
    types: [closed]      # Runs on PR close
    branches: [main]     # Only for PRs targeting main

jobs:
  deploy:
    if: github.event.pull_request.merged == true   # Only if PR is merged
    runs-on: ubuntu-latest

    env:
      SOURCE_FOLDER: "config-files/"   # <--- Change to your repo folder
      # One of:
      # /opt/fatack/ofsaa/bdf/config/datamaps
      # /opt/fatack/ofsaa/bdf/config/customs
      # /opt/fatack/ofsaa/bdf/config
      DESTINATION_FOLDER: "/opt/fatack/ofsaa/bdf/config/customs"

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      # Optional: verify content exists
      - name: List source folder content
        run: ls -R $SOURCE_FOLDER

      - name: Deploy files over SSH
        uses: easingthemes/ssh-deploy@v4
        env:
          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}
          REMOTE_HOST: ${{ secrets.SERVER_HOST }}
          REMOTE_USER: ${{ secrets.SERVER_USER }}
          ARGS: "-avzr --delete"
          SOURCE: ${{ env.SOURCE_FOLDER }}
          TARGET: ${{ env.DESTINATION_FOLDER }}
