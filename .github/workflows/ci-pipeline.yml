name: CI Pipeline (Build-Test-Lint)

on:
  push:
    branches:
      - main
      - "feature/*"
      - "hotfix/*"
  pull_request:

jobs:
  build_and_test:
    name: Build, Test, Lint, Package
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Set up Node (optional)
        if: ${{ files.exists(package.json) }}
        run: |
          # use node only if project uses node
          echo "Node step placeholder (install node if required)"

      - name: Install Dependencies
        run: |
          if [ -f package.json ]; then
            npm ci
          fi

      - name: Run Tests
        run: |
          if [ -f package.json ]; then
            npm test --if-present
          fi

      - name: Run Linter
        run: |
          if [ -f package.json ]; then
            npm run lint --if-present
          fi

      - name: Build (if applicable) and package
        run: |
          mkdir -p artifact
          # include only intended files; this example copies everything except .git
          rsync -a --exclude='.git' --exclude='node_modules' ./ artifact/
          cd artifact && zip -r ../build.zip .

      - name: Upload build artifact
        uses: actions/upload-artifact@v4
        with:
          name: build-package
          path: build.zip
